{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Build with Prism",
            "type": "shell",
            "command": "./bazel build //main:sorbet --config=dbg",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "reveal": "always"
            }
        },
        {
            "label": "Run all Prism tests",
            "type": "shell",
            "command": "./bazel test //test:prism //test:prism_location_tests --config=dbg  --test_output=all",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "presentation": {
                "reveal": "always"
            }
        },
        {
            "label": "Run a single Prism test",
            "type": "shell",
            "command": "./bazel test //test:test_PosTests/prism_regression/${input:test_name} //test:prism_regression/${input:test_name}_location_test --config=dbg  --test_output=all",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "presentation": {
                "reveal": "always"
            },
            // With this option, when running this task with the `Tasks: Rerun Last Test` command, it'll
            // reuse the previous run's input, rather than prompting for it again
            "runOptions": {
                "reevaluateOnRerun": false
            }
        },
        {
            "label": "Typecheck with Prism",
            "type": "shell",
            "command": "bazel-bin/main/sorbet --parser=prism ${input:file_path}",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "dependsOn": ["Build with Prism"],
            "presentation": {
                "reveal": "always"
            }
        },
        {
            "label": "(Re)Generate Prism test",
            "type": "shell",
            "command": "TEST_NAME=${input:test_name}; $EDITOR -w test/prism_regression/$TEST_NAME.rb; ./bazel-bin/main/sorbet --stop-after=parser --print=parse-tree test/prism_regression/$TEST_NAME.rb > test/prism_regression/$TEST_NAME.parse-tree.exp; $EDITOR test/prism_regression/$TEST_NAME.parse-tree.exp",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "presentation": {
                "reveal": "always"
            }
        },
        // This task:
        // - Runs tests to generate the pipeline_test_runner files, which are needed by the LLDB
        //   debugger to execute the tests.
        // - Sets the `BAZEL_EXEC_ROOT` environment variable, which is used by the LLDB
        //   debugger to find the source files.
        {
            "label": "Prepare tests debugging",
            "type": "shell",
            "command": "export BAZEL_EXEC_ROOT=$(./bazel info execution_root)",
            // We need to run tests first to get the pipeline_test_runner files generated
            // Just building Sorbet with Prism doesn't generate them.
            "dependsOn": ["Run all Prism tests"],
            "hide": true,
            "presentation": {
                "reveal": "never",
            }
        }
    ],
    "inputs": [
        {
            "id": "test_name",
            "type": "promptString",
            "description": "Enter the test name, e.g. case for running test/prism_regression/case.rb",
        },
        {
            "id": "file_path",
            "type": "promptString",
            "default": "test.rb",
            "description": "Enter the file path to typecheck, e.g. test.rb",
        }
    ]
}
